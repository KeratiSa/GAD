repeat wait() until game:IsLoaded()
task.wait(20)

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")

local PetUtilities = require(ReplicatedStorage.Modules.PetServices.PetUtilities)
local ReplicationClass = require(ReplicatedStorage.Modules.ReplicationClass)
local ActivePetsService = ReplicationClass.new("ActivePetsService_Replicator")

local webhookUrl = _G.Config.web_hook or ""
local PC_NAME = _G.Config.PC or "Unknown"

local function sendDiscordEmbed(title, playerName, petType, weight, level)
    local embed = {{
        title = title,
        description = string.format(
            "ðŸ’»:%s\n\nà¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™: %s\nà¸›à¸£à¸°à¹€à¸ à¸—à¸ªà¸±à¸•à¸§à¹Œ: %s\nà¸™à¹‰à¸³à¸«à¸™à¸±à¸: %.2f\nà¸­à¸²à¸¢à¸¸ (Level): %d",
            PC_NAME, playerName, petType, weight, level
        ),
        color = 0x1abc9c,
        timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ"),
        footer = {
            text = "Roblox Pet Monitor"
        }
    }}

    local payload = {
        embeds = embed
    }

    local jsonData = HttpService:JSONEncode(payload)

    local response = http_request({
        Url = webhookUrl,
        Method = "POST",
        Headers = {
            ["Content-Type"] = "application/json",
            ["Content-Length"] = tostring(#jsonData)
        },
        Body = jsonData
    })

    print("Status Code:", response.StatusCode)
    print("Response Body:", response.Body)
end

local function checkAndSend()
    local success, dataResult = pcall(function()
        return ActivePetsService:YieldUntilData()
    end)

    if success then
        local dataTable = dataResult.Table
        if dataTable and dataTable.PlayerPetData then
            local player = Players.LocalPlayer
            if not player then
                warn("LocalPlayer à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸žà¸£à¹‰à¸­à¸¡")
                return
            end

            local playerName = player.Name
            local playerPetData = dataTable.PlayerPetData[playerName]
            if playerPetData then
                local petInventory = playerPetData['PetInventory']
                if petInventory and petInventory['Data'] then
                    local petData = petInventory['Data']
                    local blacklist = {}

                    for _, v in pairs(petData) do
                        local petType = v.PetType or "Unknown"

                        if blacklist[petType] then
                            continue
                        end

                        local baseWeight = v.PetData.BaseWeight or 1
                        local level = v.PetData.Level or 1
                        local weight = PetUtilities:CalculateWeight(baseWeight, level)

                        if weight >= 20 then
                            sendDiscordEmbed("âš ï¸ à¹€à¸ˆà¸­à¸ªà¸±à¸•à¸§à¹Œà¸™à¹‰à¸³à¸«à¸™à¸±à¸à¸¡à¸²à¸!", playerName, petType, weight, level)
                        elseif (weight > 6 and level <= 10) or (weight > 10 and level <= 25) then
                            sendDiscordEmbed("ðŸ¾ à¸ªà¸±à¸•à¸§à¹Œà¹€à¸‚à¹‰à¸²à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚", playerName, petType, weight, level)
                        end
                    end
                end
            end
        end
    end
end

while true do
    print("[Pet Monitor] Checking pets at:", os.date("%Y-%m-%d %H:%M:%S"))
    checkAndSend()
    task.wait(1500) -- 25 à¸™à¸²à¸—à¸µ
end
