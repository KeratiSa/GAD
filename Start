repeat wait() until game:IsLoaded()
task.wait(10) 
getgenv().Config = {
    -- กำหนดค่าทั้งหมดที่ต้องใช้ เช่น EVENTSHOP, Auto Hatch Egg, Enable Screen Black ฯลฯ
    EVENTSHOP = { "Flower Seed Pack", "Bee Egg" },
    ["Auto Hatch Egg"] = { Enabled = true },
    ["Enable Screen Black"] = false,
    ["Screen Black FPS Cap"] = 5,
    -- ... config อื่น ๆ ...
}

task.delay(6, function()
    local ok, e = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/DonkiRoblox111/config/refs/heads/main/Alr"))()
    end)
    if not ok then
        warn("[Loader] Load secondary script failed:", e)
    end
end)
local Player = game:GetService("Players").LocalPlayer

local function getFarm()
    for _, farm in ipairs(workspace:WaitForChild("Farm"):GetChildren()) do
        local ok, owner = pcall(function()
            return farm:WaitForChild("Important").Data.Owner.Value
        end)
        if ok and owner == Player.Name then
            return farm
        end
    end
    return nil
end

local farm = getFarm()
local cachedPlayerData = nil

task.spawn(function()
    local DataService = require(game:GetService("ReplicatedStorage").Modules.DataService)
    if typeof(DataService.GetData) == "function" then
        local old = DataService.GetData
        DataService.GetData = function(self, ...)
            local data = old(self, ...)
            cachedPlayerData = data
            return data
        end
    end
end)

spawn(function()
    wait(5)
    local shop = getgenv().Config.EVENTSHOP or {}

    local function buyEventShopItems()
        local data = cachedPlayerData
        if not data or not data.EventShopStock or not data.EventShopStock.Stocks then return end

        local remote = game:GetService("ReplicatedStorage"):WaitForChild("GameEvents"):FindFirstChild("BuyEventShopStock")
        if not remote then return end

        for _, itemName in ipairs(shop) do
            local stock = data.EventShopStock.Stocks[itemName]
            if stock and stock.Stock > 0 then
                pcall(function()
                    remote:FireServer(itemName)
                    print("[EventShop] Bought:", itemName)
                end)
                task.wait()
            end
        end
    end

    while task.wait(5) do
        pcall(buyEventShopItems)
    end
end)

spawn(function()
    if not (farm and getgenv().Config["Auto Hatch Egg"] and getgenv().Config["Auto Hatch Egg"].Enabled) then 
        print("[Auto Hatch Egg] Disabled or farm not found")
        return 
    end
    print("[Auto Hatch Egg] Started")
    while task.wait(5) do
        pcall(function()
            for _, egg in ipairs(farm:WaitForChild("Important").Objects_Physical:GetChildren()) do
                if egg.Name ~= "PetEgg" then continue end
                if egg:GetAttribute("TimeToHatch") == 0 then
                    game:GetService("ReplicatedStorage"):WaitForChild("GameEvents")
                        :WaitForChild("PetEggService"):FireServer("HatchPet", egg)
                    print("[Auto Hatch Egg] Hatch Pet Egg:", egg)
                end
            end
        end)
    end
end)

task.spawn(function()
    repeat wait() until game:IsLoaded() and game.Players.LocalPlayer
    if not getgenv().Config["Enable Screen Black"] then
        task.delay(6, function()
            pcall(function()
                local fpsCap = getgenv().Config["Screen Black FPS Cap"] or 30
                if typeof(setfpscap) == "function" then setfpscap(fpsCap) end
                for _, gui in ipairs(game.Players.LocalPlayer.PlayerGui:GetChildren()) do
                    if gui:IsA("ScreenGui") and gui.Name:lower():find("black") then
                        gui:Destroy()
                        print("[Screen Black] Removed black GUI:", gui.Name)
                    end
                end
            end)
        end)
    end
end)
